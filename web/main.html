<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»æ§åˆ¶å°</title>
    <style>
        /* --- å…¨å±€æ ·å¼ (æ— å˜åŒ–) --- */
        :root {
            --primary-color: #3a7bd5;
            --secondary-color: #3a6073;
            --bg-color: #f4f7f6;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ecf0f1;
            --sidebar-hover: #34495e;
            --white-color: #fff;
            --border-color: #e0e0e0;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: #333;
            visibility: hidden;
        }
        .dashboard-container { display: flex; min-height: 100vh; }

        /* --- ä¾§è¾¹æ  (æ— å˜åŒ–) --- */
        .sidebar { width: 240px; background-color: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; transition: width 0.3s ease; }
        .sidebar-header { padding: 20px; text-align: center; font-size: 1.5em; font-weight: bold; border-bottom: 1px solid var(--sidebar-hover); }
        .sidebar-nav ul { list-style: none; padding: 0; margin: 20px 0; }
        .sidebar-nav li a { display: block; padding: 15px 20px; color: var(--sidebar-text); text-decoration: none; transition: background-color 0.2s; font-size: 1.1em; cursor: pointer; /* å°†å…‰æ ‡æ”¹ä¸ºæ‰‹å‹ */ }
        .sidebar-nav li a:hover, .sidebar-nav li a.active { background-color: var(--sidebar-hover); }
        .sidebar-footer { margin-top: auto; padding: 20px; text-align: center; }
        #logout-button { width: 100%; padding: 10px; border: none; border-radius: 5px; background-color: var(--primary-color); color: var(--white-color); cursor: pointer; font-size: 1em; }
        #logout-button:hover { opacity: 0.9; }
        #game-entry-button { width: 100%; margin-top: 10px; padding: 10px; border: none; border-radius: 5px; background-color: #ff9800; color: #fff; cursor: pointer; font-size: 1em; }

        /* --- ä¸»å†…å®¹åŒº (æ— å˜åŒ–) --- */
        .main-content { flex-grow: 1; padding: 30px; }
        .header { font-size: 2.5em; font-weight: 300; margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .content-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { background-color: var(--white-color); padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .card h3 { margin-top: 0; color: var(--secondary-color); }

        /* --- ã€æ–°å¢CSSã€‘ç”¨äºæ§åˆ¶é¡µé¢å†…å®¹çš„æ˜¾ç¤ºä¸éšè— --- */
        .page-content {
            display: none; /* é»˜è®¤éšè—æ‰€æœ‰é¡µé¢å†…å®¹ */
        }
        .page-content.active {
            display: block; /* åªæ˜¾ç¤ºå¸¦æœ‰ active ç±»çš„é¡µé¢å†…å®¹ */
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… (æ— å˜åŒ–) */
        @media (max-width: 768px) {
            .dashboard-container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; }
            .main-content { padding: 20px; }
        }
    </style>
</head>
<body>

    <!-- è·¯ç”±å®ˆå«è„šæœ¬ (æ— å˜åŒ–) -->
    <script>
        (function() {
            const token = localStorage.getItem('authToken');
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            
            if (!token) {
                // ç¡®ä¿è¿™é‡Œçš„ 'login.html' æˆ– 'index.html' æ˜¯ä½ æ­£ç¡®çš„ç™»å½•é¡µæ–‡ä»¶å
                window.location.replace('index.html');
            } else {
                document.body.style.visibility = 'visible';
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºç®¡ç†å‘˜å…¥å£
                if (isAdmin) {
                    const adminPortal = document.getElementById('admin-portal');
                    if (adminPortal) {
                        adminPortal.style.display = 'block';
                    }
                }
            }
        })();
    </script>
    
    <div class="dashboard-container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="sidebar">
            <div class="sidebar-header">
                æ§åˆ¶å°
            </div>
            <!-- ã€HTMLä¿®æ”¹ã€‘ä¸ºå¯¼èˆªé“¾æ¥æ·»åŠ  data-page å±æ€§ -->
            <nav class="sidebar-nav">
                <ul>
                    <li><a data-page="dashboard" class="active">ä»ªè¡¨ç›˜</a></li>
                    <li><a data-page="users">ç”¨æˆ·ç®¡ç†</a></li>
                    <li><a data-page="products">äº§å“ä¸­å¿ƒ</a></li>
                    <li><a data-page="settings">ç³»ç»Ÿè®¾ç½®</a></li>
                    <li id="admin-portal" style="display: none;"><a href="admin.html" style="color: #ffd700; font-weight: bold;">ğŸ‘‘ ç®¡ç†å‘˜æ§åˆ¶å°</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button id="logout-button">å®‰å…¨é€€å‡º</button>
                <button id="game-entry-button" style="width:100%;margin-top:10px;padding:10px;border:none;border-radius:5px;background-color:#ff9800;color:#fff;cursor:pointer;font-size:1em;">è¿›å…¥æ¸¸æˆ</button>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- ã€HTMLä¿®æ”¹ã€‘å°†ä¸åŒçš„é¡µé¢å†…å®¹åŒ…è£¹åœ¨å¸¦æœ‰ id å’Œ class çš„ div ä¸­ -->

            <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
            <div id="dashboard-page" class="page-content active">
                <h1 class="header">ä»ªè¡¨ç›˜</h1>
                <p style="margin-bottom: 30px;">åœ¨è¿™é‡Œæ¦‚è§ˆä½ çš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®ã€‚</p>
                <div class="content-grid">
                    <div class="card">
                        <h3>æ•°æ®æ¦‚è§ˆ</h3>
                        <p>æŸ¥çœ‹ä»Šæ—¥è®¿é—®é‡ã€é”€å”®é¢ç­‰æ ¸å¿ƒæ•°æ®æŒ‡æ ‡ã€‚</p>
                    </div>
                    <div class="card">
                        <h3>å¿«é€Ÿæ“ä½œ</h3>
                        <p>å‘å¸ƒæ–°æ–‡ç« ã€ä¸Šä¼ æ–°äº§å“æˆ–å¤„ç†å¾…åŠäº‹é¡¹ã€‚</p>
                    </div>
                    <div class="card">
                        <h3>è¿‘æœŸæ´»åŠ¨</h3>
                        <p>æŸ¥çœ‹æœ€è¿‘çš„ç”¨æˆ·åŠ¨æ€å’Œç³»ç»Ÿé€šçŸ¥ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
            <div id="users-page" class="page-content">
                <h1 class="header">ç”¨æˆ·ç®¡ç†</h1>
                <p>è¿™é‡Œæ˜¯ç”¨æˆ·ç®¡ç†çš„å†…å®¹åŒºåŸŸã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç”¨æˆ·åˆ—è¡¨ã€æœç´¢æ¡†ç­‰ç»„ä»¶ã€‚</p>
                <!-- æœªæ¥å¯ä»¥å¡«å……ç”¨æˆ·è¡¨æ ¼ç­‰ -->
            </div>

            <!-- äº§å“ä¸­å¿ƒé¡µé¢ -->
            <div id="products-page" class="page-content">
                <h1 class="header">äº§å“ä¸­å¿ƒ</h1>
                <p>è¿™é‡Œæ˜¯äº§å“ä¸­å¿ƒçš„å†…å®¹åŒºåŸŸã€‚ç”¨äºå±•ç¤ºå’Œç®¡ç†ä½ çš„äº§å“ã€‚</p>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
            <div id="settings-page" class="page-content">
                <h1 class="header">ç³»ç»Ÿè®¾ç½®</h1>
                <p>è¿™é‡Œæ˜¯ç³»ç»Ÿè®¾ç½®çš„å†…å®¹åŒºåŸŸã€‚å¯ä»¥æ”¾ç½®ä¿®æ”¹å¯†ç ã€ä¸»é¢˜åˆ‡æ¢ç­‰åŠŸèƒ½ã€‚</p>
            </div>
        </main>
    </div>

    <!-- ã€JavaScriptä¿®æ”¹ã€‘åœ¨åŸæœ‰çš„ç™»å‡ºé€»è¾‘ä¸Šï¼Œå¢åŠ é¡µé¢åˆ‡æ¢é€»è¾‘ -->
    <script>
        // --- é¡µé¢åˆ‡æ¢é€»è¾‘ ---
        const navLinks = document.querySelectorAll('.sidebar-nav a');
        const pageContents = document.querySelectorAll('.page-content');

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault(); // é˜»æ­¢ a æ ‡ç­¾çš„é»˜è®¤è·³è½¬è¡Œä¸º

                const targetPageId = link.getAttribute('data-page');

                // 1. æ›´æ–°å¯¼èˆªé“¾æ¥çš„æ¿€æ´»çŠ¶æ€
                navLinks.forEach(navLink => navLink.classList.remove('active'));
                link.classList.add('active');

                // 2. åˆ‡æ¢ä¸»å†…å®¹çš„æ˜¾ç¤º
                pageContents.forEach(content => {
                    if (content.id === `${targetPageId}-page`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            });
        });

        // --- æ¸¸æˆå…¥å£è·³è½¬ ---
        document.getElementById('game-entry-button').onclick = function() {
            window.location.href = 'catKingdom/game.html';
        };

        // --- ç™»å‡ºé€»è¾‘ (æ— å˜åŒ–) ---
        const logoutButton = document.getElementById('logout-button');
        
        logoutButton.addEventListener('click', () => {
            const token = localStorage.getItem('authToken');
            localStorage.removeItem('authToken');
            localStorage.removeItem('isAdmin');
            localStorage.removeItem('userRole');
            
            // (å¯é€‰) é€šçŸ¥åç«¯ token å·²å¤±æ•ˆ
            if(token) {
                 fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    }
                }).catch(err => {
                    console.error('ç™»å‡ºè¯·æ±‚å¤±è´¥:', err);
                });
            }
            
            // é‡å®šå‘åˆ°ç™»å½•é¡µé¢
            // ç¡®ä¿è¿™é‡Œçš„ 'login.html' æˆ– 'index.html' æ˜¯ä½ æ­£ç¡®çš„ç™»å½•é¡µæ–‡ä»¶å
            window.location.replace('index.html');
        });
    </script>
</body>
</html>
